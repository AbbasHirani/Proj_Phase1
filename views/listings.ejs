<% layout("/layouts/boilerplate.ejs") %>

<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Explore Listings</h2>
    <a href="/listings/new" class="btn btn-success rounded-pill px-4">
      <i class="fa fa-plus-circle me-2"></i>Add New Listing
    </a>
  </div>

  <div class="row g-4">
    <% for (let list of alllisting) { %>
      <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
        <a href="/listings/<%= list._id %>" class="text-decoration-none text-dark">
          <div class="card border-0 shadow-sm rounded-4 overflow-hidden h-100 listing-card">
            
            <!-- Image + Wishlist -->
            <div class="position-relative">
              <img src="<%= list.image.url %>" alt="<%= list.title %>" class="card-img-top listing-img">
              <div class="wishlist-btn position-absolute top-0 end-0 m-2">
                <i class="fa-regular fa-heart"></i>
              </div>
            </div>

            <!-- Body -->
            <div class="card-body">
              <h6 class="fw-bold text-truncate mb-1"><%= list.title %></h6>
              <div class="text-muted small mb-2">
                <i class="fa fa-map-marker-alt me-1 text-danger"></i> <%= list.location %>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <div class="fw-bold text-success">
                  â‚¹<%= list.price %><span class="text-muted small">/night</span>
                </div>
                <div class="text-warning small">
                  <i class="fa fa-star me-1"></i>4.8
                </div>
              </div>
            </div>

          </div>
        </a>
      </div>
    <% } %>
  </div>
</div>

<!-- Styles -->
<style>
.listing-card {
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}
.listing-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}
.listing-img {
  height: 200px;
  object-fit: cover;
  transition: transform 0.4s ease;
}
.listing-card:hover .listing-img {
  transform: scale(1.05);
}
.wishlist-btn {
  width: 38px;
  height: 38px;
  background-color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  cursor: pointer;
}
.wishlist-btn i {
  font-size: 1.2rem;
  color: #555;
}
.wishlist-btn.liked i {
  color: #dc3545;
}
</style>

<!-- Script -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".wishlist-btn").forEach(btn => {
    btn.addEventListener("click", function (e) {
      e.preventDefault(); // Prevent link click
      e.stopPropagation(); // Stop card link navigation
      const icon = this.querySelector("i");
      if (icon.classList.contains("fa-regular")) {
        icon.classList.remove("fa-regular");
        icon.classList.add("fa-solid");
        this.classList.add("liked");
      } else {
        icon.classList.remove("fa-solid");
        icon.classList.add("fa-regular");
        this.classList.remove("liked");
      }
    });
  });
});
</script>

<!-- Make sure you have Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
